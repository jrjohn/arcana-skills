---
name: app-uiux-designer
description: |
  Enterprise UI/UX design expert using Chain of Repository (CoR) architecture.
  SRS/SDD â†’ 100% UI/UX + 100% Navigation.
  Platform: iOS HIG / Material Design 3 / WCAG.

  âš ï¸ æœ¬ Skill åƒ…è² è²¬ Phase 3: UI Flow ç”¢ç”Ÿ
  æ™ºæ…§é æ¸¬å·²åœ¨ Phase 2 (app-requirements-skill) å®Œæˆ
---

# UI/UX Designer Skill (Chain of Repository)

**Core:** SDD (å«å®Œæ•´ç•«é¢æ¸…å–®) â†’ 100% UI/UX ç”Ÿæˆ â†’ 100% Navigation é©—è­‰
**Architecture:** Chain of Repository - æŒ‰éœ€è¼‰å…¥ç¯€é»ï¼Œæ¸›å°‘ token ä½¿ç”¨

---

## èˆ‡ app-requirements-skill æ•´åˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 1-2: ç”± app-requirements-skill è² è²¬                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ SRS æ’°å¯«                                                      â”‚
â”‚ â€¢ SDD æ’°å¯« + æ™ºæ…§é æ¸¬ + ç•«é¢è£œå……                                  â”‚
â”‚ â€¢ ç¢ºèªå®Œæ•´ç•«é¢æ¸…å–® (Appendix A)                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
              âš ï¸ é€²å…¥æ¢ä»¶: SDD å®Œæ•´ + æ™ºæ…§é æ¸¬å®Œæˆ
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 3: ç”± app-uiux-designer.skill è² è²¬ â† æœ¬ Skill              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Step 1: UI Flow æ¡†æ¶åˆå§‹åŒ– (00-init)                             â”‚
â”‚ Step 2: ç”¢å‡ºå®Œæ•´ UI Flow HTML (03-generation)                    â”‚
â”‚ Step 3: å°èˆªé©—è­‰ (04-validation)                                 â”‚
â”‚ Step 4: UI Flow Diagram ç”¢å‡º (05-diagram)                        â”‚
â”‚ Step 5: ç”¢å‡ºæˆªåœ– (06-screenshot)                                 â”‚
â”‚ Step 6: å›è£œ SDD/SRS + é‡æ–°ç”¢ç”Ÿ DOCX (07-feedback) âš ï¸            â”‚
â”‚ Step 7: æœ€çµ‚é©—è­‰ + å®Œæˆå ±å‘Š (08-finalize)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
                        âœ… UI Flow å®Œæˆ
```

### 07-feedback å›è£œå…§å®¹ (MANDATORY)

| æ–‡ä»¶ | å›è£œå…§å®¹ |
|------|----------|
| **SDD** | æ¯å€‹ SCR-* å€å¡ŠåŠ å…¥ UI åŸå‹åƒè€ƒ (iPad/iPhone æˆªåœ–)ã€ç¢ºèª `å°æ‡‰éœ€æ±‚` æ¬„ä½ |
| **SRS** | æ–°å¢ Screen References ç« ç¯€ã€Inferred Requirementsã€User Flowsã€**åŠ å…¥ `SDD è¿½è¹¤` æ¬„ä½** |
| **DOCX** | é‡æ–°ç”¢ç”Ÿ SDD.docx å’Œ SRS.docx (å«åµŒå…¥åœ–ç‰‡) |

### IEC 62304 é›™å‘è¿½è¹¤ (MANDATORY)

> âš ï¸ **å¼·åˆ¶è¦æ±‚**ï¼šå›è£œæ™‚å¿…é ˆå»ºç«‹ SRS â†” SDD é›™å‘è¿½è¹¤

| æ–¹å‘ | æ¬„ä½ | ç¯„ä¾‹ |
|------|------|------|
| SRS â†’ SDD | `\| **SDD è¿½è¹¤** \| SCR-xxx \|` | `SCR-AUTH-001-login, SCR-AUTH-002-register` |
| SDD â†’ SRS | `\| **å°æ‡‰éœ€æ±‚** \| REQ-xxx \|` | `REQ-AUTH-001, REQ-AUTH-002` |

---

## è¨­è¨ˆç†å¿µ

> **ç›®æ¨™æ˜¯ 100% å®Œæˆ UI/UXï¼Œä¸æ˜¯éƒ¨åˆ†å¯¦ä½œï¼**

### é©—è­‰æ¨™æº– (å…¨éƒ¨å¿…é ˆé”æˆ)

| é …ç›® | è¦æ±‚ |
|------|------|
| UI/UX è¦†è“‹ç‡ | 100% - æ‰€æœ‰ SDD ç•«é¢éƒ½å·²ç”Ÿæˆ |
| å°èˆªè¦†è“‹ç‡ | 100% - æ‰€æœ‰å¯é»æ“Šå…ƒç´ éƒ½æœ‰æœ‰æ•ˆå°èˆª |
| ç©ºæŒ‰éˆ• | 0 å€‹ - ç¦æ­¢ `onclick=""` |
| Alert ä½”ä½ç¬¦ | 0 å€‹ - ç¦æ­¢ `onclick="alert('...')"` |

### ç¦æ­¢é …ç›®

- âŒ `onclick=""` æˆ–ç„¡ onclick
- âŒ `onclick="alert('åŠŸèƒ½èªªæ˜')"`
- âŒ `href="#"` æ‡¸ç©ºé€£çµ
- âŒ éƒ¨åˆ†ç•«é¢å¯¦ä½œ

---

## ğŸš¨ onclick ç”Ÿæˆå¼·åˆ¶è¦å‰‡ (CRITICAL)

> **ç”Ÿæˆä»»ä½• `<button>` æ¨™ç±¤æ™‚ï¼Œå¿…é ˆåŒæ™‚å¯«å…¥ `onclick` å±¬æ€§ï¼**

### ç”Ÿæˆæ™‚å¼·åˆ¶æª¢æŸ¥æµç¨‹

```
å¯« <button> æ¨™ç±¤æ™‚ï¼š
1. æŸ¥ SDD Button Navigation â†’ æœ‰ç›®æ¨™ â†’ ä½¿ç”¨æŒ‡å®šç›®æ¨™
                           â†“ ç„¡
2. æ ¹æ“šæŒ‰éˆ•æ–‡å­—é æ¸¬ â†’ å¯é æ¸¬ â†’ ä½¿ç”¨é æ¸¬ç›®æ¨™
                   â†“ ç„¡æ³•é æ¸¬
3. ä½¿ç”¨åˆç†é è¨­ â†’ æŸ¥çœ‹é¡ â†’ ç›¸é—œè©³æƒ…é 
               â†’ æ“ä½œé¡ â†’ history.back() æˆ–ä¾†æºé 
```

### å¸¸è¦‹æŒ‰éˆ•æ–‡å­—é è¨­ç›®æ¨™

| æŒ‰éˆ•æ–‡å­— | é è¨­ç›®æ¨™ |
|----------|----------|
| æŸ¥çœ‹çå‹µ/æˆå°± | `../engage/SCR-ENGAGE-004-badges.html` |
| æŸ¥çœ‹å ±è¡¨ | `../progress/SCR-PROGRESS-001-overview.html` |
| é–‹å§‹å­¸ç¿’ | `../train/SCR-TRAIN-001-select-vocab.html` |
| å„²å­˜/ä¿å­˜/å–æ¶ˆ | `history.back()` |
| è¨­å®š | `../setting/SCR-SETTING-001-main.html` |

### ç”Ÿæˆå¾Œè‡ªæª¢å‘½ä»¤

```bash
# æ¯å€‹ç•«é¢ç”Ÿæˆå¾Œç«‹å³åŸ·è¡Œ
grep -n '<button' SCR-*.html | grep -v 'onclick='
# è‹¥æœ‰è¼¸å‡º â†’ å¿…é ˆç«‹å³ä¿®å¾©ï¼
```

**è©³ç´°è¦å‰‡**: è¦‹ `process/03-generation/README.md` Step 3

---

## Quick Start

1. **æª¢æŸ¥é€²å…¥æ¢ä»¶**: ç¢ºèª SDD å·²å®Œæˆæ™ºæ…§é æ¸¬
2. **æª¢æŸ¥ç‹€æ…‹**: è®€å– `{PROJECT}/04-ui-flow/workspace/current-process.json`
3. **é€²å…¥ç¯€é»**: è®€å–å°æ‡‰çš„ `[SKILL_DIR]/process/XX/README.md`
4. **åŸ·è¡Œæ­¥é©Ÿ**: ä¾ç…§ README.md åŸ·è¡Œ
5. **âš ï¸ è‡ªå‹•é©—è­‰**: æ¯å€‹ç¯€é»å®Œæˆå‰**å¿…é ˆ**åŸ·è¡Œé©—è­‰ (è¦‹ä¸‹æ–¹ Auto-Validation è¦å‰‡)
6. **æ›´æ–°ç‹€æ…‹**: é©—è­‰é€šéå¾Œæ›´æ–° `workspace/current-process.json`

> âš ï¸ **é‡è¦**: `workspace/` ç›®éŒ„ä½æ–¼**å°ˆæ¡ˆçš„ 04-ui-flow/** ä¸‹ï¼Œä¸æ˜¯ skill ç›®éŒ„ï¼

---

## âš ï¸ Auto-Validation Rules (MANDATORY - ä¸å¯è·³é)

> **Claude å¿…é ˆåœ¨æ¯å€‹ç¯€é»å®Œæˆå‰è‡ªå‹•åŸ·è¡Œé©—è­‰ï¼Œç„¡éœ€ç”¨æˆ¶æé†’ï¼**

### é©—è­‰è§¸ç™¼æ™‚æ©Ÿ

| ç¯€é» | ä½•æ™‚é©—è­‰ | é©—è­‰å…§å®¹ |
|------|----------|----------|
| 00-init | æ¨¡æ¿è¤‡è£½å®Œæˆå¾Œ | æ¨¡æ¿å®Œæ•´æ€§ã€è®Šæ•¸æ›¿æ› |
| 03-generation | ç•«é¢ç”Ÿæˆå®Œæˆå¾Œ | **Template Compliance Gate** |
| 04-validation | ä¿®å¾©å®Œæˆå¾Œ | å°èˆª 100% + ä¸€è‡´æ€§ |
| 06-screenshot | æˆªåœ–ç”¢ç”Ÿå¾Œ | æˆªåœ–æª”æ¡ˆå­˜åœ¨ |
| 07-feedback | å›è£œå®Œæˆå¾Œ | **UI åŸå‹åƒè€ƒå®Œæ•´æ€§ + Use Case å®Œæ•´æ€§** |

### 03-generation Template Compliance Gate (Critical)

> **åœ¨æ¨™è¨˜ 03-generation ç‚º completed å‰ï¼Œå¿…é ˆé€šéä»¥ä¸‹æ‰€æœ‰é©—è­‰ï¼**

```bash
#!/bin/bash
# === Template Compliance Gate (è‡ªå‹•åŸ·è¡Œ) ===
cd {PROJECT}/04-ui-flow

ERRORS=0

echo "ğŸ” åŸ·è¡Œ Template Compliance Gate..."

# 1. index.html å®Œæ•´æ€§
echo ""
echo "ğŸ“Š é©—è­‰ index.html æ¨¡æ¿åˆè¦..."
grep -q 'flow-iframe' index.html || { echo "âŒ ç¼ºå°‘ UI Flow Diagram iframe"; ERRORS=$((ERRORS+1)); }
grep -q 'switchDevice' index.html || { echo "âŒ ç¼ºå°‘è£ç½®åˆ‡æ›åŠŸèƒ½"; ERRORS=$((ERRORS+1)); }
grep -q 'device-toggle-btn' index.html || { echo "âŒ ç¼ºå°‘è£ç½®åˆ‡æ›æŒ‰éˆ•"; ERRORS=$((ERRORS+1)); }
grep -q 'sidebar' index.html || { echo "âŒ ç¼ºå°‘æ¨¡çµ„åœ–ä¾‹å´é‚Šæ¬„"; ERRORS=$((ERRORS+1)); }
grep -q '{{' index.html && { echo "âŒ æœ‰æœªæ›¿æ›è®Šæ•¸"; ERRORS=$((ERRORS+1)); }
[ $ERRORS -eq 0 ] && echo "âœ… index.html åŸºæœ¬åˆè¦"

# 2. index.html é›™ç‰ˆæœ¬ Diagram åˆ‡æ›æª¢æ ¸ (MANDATORY)
echo ""
echo "ğŸ“± é©—è­‰ index.html å¼•ç”¨ iPad/iPhone é›™ç‰ˆæœ¬ Diagram..."
grep -q 'ui-flow-diagram-ipad.html' index.html || { echo "âŒ index.html ç¼ºå°‘ ui-flow-diagram-ipad.html å¼•ç”¨"; ERRORS=$((ERRORS+1)); }
grep -q 'ui-flow-diagram-iphone.html' index.html || { echo "âŒ index.html ç¼ºå°‘ ui-flow-diagram-iphone.html å¼•ç”¨"; ERRORS=$((ERRORS+1)); }
# ç¢ºèª switchDevice ä½¿ç”¨ç¨ç«‹æª”æ¡ˆè€Œé query parameter
grep -q "ui-flow-diagram.html?device=" index.html && { echo "âŒ index.html ä½¿ç”¨èˆŠç‰ˆ query parameter åˆ‡æ›æ–¹å¼ï¼Œæ‡‰ä½¿ç”¨ç¨ç«‹æª”æ¡ˆ"; ERRORS=$((ERRORS+1)); }
[ $ERRORS -eq 0 ] && echo "âœ… index.html é›™ç‰ˆæœ¬åˆ‡æ›æ­£ç¢º"

# 3. docs/ui-flow-diagram-ipad.html å­˜åœ¨èˆ‡ç•«é¢åŒæ­¥
echo ""
echo "ğŸ“± é©—è­‰ ui-flow-diagram-ipad.html..."
IPAD_COUNT=$(find . -name "SCR-*.html" -not -path "./iphone/*" -not -path "./docs/*" | wc -l | tr -d ' ')
[ -f "docs/ui-flow-diagram-ipad.html" ] || { echo "âŒ ç¼ºå°‘ docs/ui-flow-diagram-ipad.html"; ERRORS=$((ERRORS+1)); }
if [ -f "docs/ui-flow-diagram-ipad.html" ]; then
  IPAD_DIAGRAM_COUNT=$(grep -c 'onclick="openScreen\|screen-card' docs/ui-flow-diagram-ipad.html 2>/dev/null | head -1 || echo "0")
  # ä½¿ç”¨ onclick è¨ˆæ•¸æ›´æº–ç¢º
  IPAD_DIAGRAM_COUNT=$(grep -c 'onclick="openScreen' docs/ui-flow-diagram-ipad.html 2>/dev/null || echo "0")
  [ "$IPAD_DIAGRAM_COUNT" -eq "$IPAD_COUNT" ] && echo "âœ… iPad Diagram ç•«é¢æ•¸: $IPAD_DIAGRAM_COUNT" || { echo "âŒ iPad Diagram ($IPAD_DIAGRAM_COUNT) â‰  å¯¦éš› ($IPAD_COUNT)"; ERRORS=$((ERRORS+1)); }
fi

# 4. docs/ui-flow-diagram-iphone.html å­˜åœ¨èˆ‡ç•«é¢åŒæ­¥
echo ""
echo "ğŸ“± é©—è­‰ ui-flow-diagram-iphone.html..."
[ -f "docs/ui-flow-diagram-iphone.html" ] || { echo "âŒ ç¼ºå°‘ docs/ui-flow-diagram-iphone.html"; ERRORS=$((ERRORS+1)); }
if [ -f "docs/ui-flow-diagram-iphone.html" ]; then
  IPHONE_DIAGRAM_COUNT=$(grep -c 'onclick="openScreen\|onclick="loadScreen' docs/ui-flow-diagram-iphone.html 2>/dev/null || echo "0")
  [ "$IPHONE_DIAGRAM_COUNT" -eq "$IPAD_COUNT" ] && echo "âœ… iPhone Diagram ç•«é¢æ•¸: $IPHONE_DIAGRAM_COUNT" || { echo "âŒ iPhone Diagram ($IPHONE_DIAGRAM_COUNT) â‰  å¯¦éš› ($IPAD_COUNT)"; ERRORS=$((ERRORS+1)); }
fi

# 5. device-preview.html å´é‚Šæ¬„åŒæ­¥
echo ""
echo "ğŸ“± é©—è­‰ device-preview.html å´é‚Šæ¬„åŒæ­¥..."
SIDEBAR_COUNT=$(grep -c 'screen-item' device-preview.html 2>/dev/null || echo "0")
[ "$SIDEBAR_COUNT" -eq "$IPAD_COUNT" ] && echo "âœ… device-preview å´é‚Šæ¬„: $SIDEBAR_COUNT" || { echo "âŒ device-preview ($SIDEBAR_COUNT) â‰  å¯¦éš› ($IPAD_COUNT)"; ERRORS=$((ERRORS+1)); }

# 6. åŸ·è¡Œ Post-Generation Gate (æ•´åˆæ‰€æœ‰é©—è­‰)
echo ""
echo "ğŸš¨ åŸ·è¡Œ Post-Generation Gate..."
node ~/.claude/skills/app-uiux-designer.skill/templates/ui-flow/post-generation-gate.js || ERRORS=$((ERRORS+1))

# çµæœ
echo ""
echo "======================================"
if [ $ERRORS -eq 0 ]; then
  echo "âœ… Template Compliance Gate PASSED"
  echo "å¯ä»¥æ¨™è¨˜ 03-generation ç‚º completed"
else
  echo "âŒ Template Compliance Gate FAILED ($ERRORS errors)"
  echo "ç¦æ­¢é€²å…¥ä¸‹ä¸€éšæ®µï¼è«‹ä¿®å¾©å•é¡Œå¾Œé‡æ–°é©—è­‰ã€‚"
  exit 1
fi
```

> **Claude å¿…é ˆåœ¨ç”¢ç”Ÿ index.html / device-preview.html å¾Œç«‹å³åŸ·è¡Œ post-generation-gate.js**

### é©—è­‰å¤±æ•—è™•ç†

| å¤±æ•—é …ç›® | ä¿®å¾©å‹•ä½œ |
|----------|----------|
| ç¼ºå°‘ UI Flow Diagram iframe | å¾ `templates/ui-flow/index.html` è¤‡è£½å€å¡Š |
| ç¼ºå°‘è£ç½®åˆ‡æ›åŠŸèƒ½ | å¾æ¨¡æ¿è¤‡è£½ `switchDevice()` å‡½æ•¸ |
| ç¼ºå°‘æ¨¡çµ„åœ–ä¾‹å´é‚Šæ¬„ | å¾æ¨¡æ¿è¤‡è£½ sidebar å€å¡Š |
| index.html ç¼ºå°‘ iPad/iPhone é›™ç‰ˆæœ¬å¼•ç”¨ | ç¢ºä¿ `switchDevice()` ä½¿ç”¨ `ui-flow-diagram-ipad.html` å’Œ `ui-flow-diagram-iphone.html` |
| ä½¿ç”¨èˆŠç‰ˆ query parameter åˆ‡æ› | å°‡ `ui-flow-diagram.html?device=X` æ”¹ç‚ºç¨ç«‹æª”æ¡ˆè·¯å¾‘ |
| ç¼ºå°‘ ui-flow-diagram-ipad.html | å»ºç«‹ iPad ç‰ˆæœ¬ Diagram (æ©«å‘æ¡†æ¶ 200x140) |
| ç¼ºå°‘ ui-flow-diagram-iphone.html | å»ºç«‹ iPhone ç‰ˆæœ¬ Diagram (ç›´å‘æ¡†æ¶ 120x260) |
| iPad/iPhone Diagram ç•«é¢æ•¸ä¸ç¬¦ | åŒæ­¥æ›´æ–°å°æ‡‰çš„ Diagram HTML |
| device-preview å´é‚Šæ¬„ä¸ç¬¦ | åŒæ­¥æ›´æ–° `device-preview.html` |
| ä¸€è‡´æ€§é©—è­‰å¤±æ•— | ä¾æ“šéŒ¯èª¤è¨Šæ¯ä¿®å¾© |

### ğŸš¨ iframe src Path Validation (BLOCKING - å¼·åˆ¶é©—è­‰)

> **æ‰€æœ‰ iframe src è·¯å¾‘å¿…é ˆæŒ‡å‘å¯¦éš›å­˜åœ¨çš„ HTML æª”æ¡ˆï¼**

```bash
#!/bin/bash
# === iframe src Path Validation (BLOCKING) ===
cd {PROJECT}/04-ui-flow

ERRORS=0
echo "ğŸ” åŸ·è¡Œ iframe src è·¯å¾‘å®Œæ•´æ€§é©—è­‰..."

# 1. å–å¾—å¯¦éš›ç•«é¢æª”æ¡ˆæ¸…å–®
IPAD_COUNT=$(find . -name "SCR-*.html" -not -path "./iphone/*" -not -path "./docs/*" | wc -l | tr -d ' ')
IPHONE_COUNT=$(find ./iphone -name "SCR-*.html" 2>/dev/null | wc -l | tr -d ' ')
echo "ğŸ“Š å¯¦éš›ç•«é¢: iPad=$IPAD_COUNT, iPhone=$IPHONE_COUNT"

# 2. é©—è­‰ ui-flow-diagram-ipad.html çš„ iframe src
echo ""
echo "ğŸ“± é©—è­‰ ui-flow-diagram-ipad.html iframe src..."
if [ -f "docs/ui-flow-diagram-ipad.html" ]; then
  IPAD_MISSING=0
  for src in $(grep -oE "src=\"\.\./[^\"]+\.html\"" docs/ui-flow-diagram-ipad.html | sed 's/src="\.\.\/\([^"]*\)"/\1/' | sort -u); do
    if [ ! -f "$src" ]; then
      echo "âŒ ç¼ºå°‘æª”æ¡ˆ: $src"
      IPAD_MISSING=$((IPAD_MISSING+1))
    fi
  done
  [ $IPAD_MISSING -eq 0 ] && echo "âœ… iPad Diagram: å…¨éƒ¨è·¯å¾‘æ­£ç¢º" || { echo "âŒ iPad Diagram ç¼ºå°‘ $IPAD_MISSING å€‹æª”æ¡ˆ"; ERRORS=$((ERRORS+IPAD_MISSING)); }
fi

# 3. é©—è­‰ ui-flow-diagram-iphone.html çš„ iframe src
echo ""
echo "ğŸ“± é©—è­‰ ui-flow-diagram-iphone.html iframe src..."
if [ -f "docs/ui-flow-diagram-iphone.html" ]; then
  IPHONE_MISSING=0
  for src in $(grep -oE "src=\"\.\./[^\"]+\.html\"" docs/ui-flow-diagram-iphone.html | sed 's/src="\.\.\/\([^"]*\)"/\1/' | sort -u); do
    if [ ! -f "$src" ]; then
      echo "âŒ ç¼ºå°‘æª”æ¡ˆ: $src"
      IPHONE_MISSING=$((IPHONE_MISSING+1))
    fi
  done
  [ $IPHONE_MISSING -eq 0 ] && echo "âœ… iPhone Diagram: å…¨éƒ¨è·¯å¾‘æ­£ç¢º" || { echo "âŒ iPhone Diagram ç¼ºå°‘ $IPHONE_MISSING å€‹æª”æ¡ˆ"; ERRORS=$((ERRORS+IPHONE_MISSING)); }
fi

# 4. é©—è­‰ device-preview.html çš„ loadScreen è·¯å¾‘
echo ""
echo "ğŸ“± é©—è­‰ device-preview.html loadScreen è·¯å¾‘..."
if [ -f "device-preview.html" ]; then
  PREVIEW_MISSING=0
  for src in $(grep -oE "loadScreen\('[^']+\.html'" device-preview.html | sed "s/loadScreen('//" | sed "s/'$//" | sort -u); do
    if [ ! -f "$src" ]; then
      echo "âŒ ç¼ºå°‘æª”æ¡ˆ: $src"
      PREVIEW_MISSING=$((PREVIEW_MISSING+1))
    fi
  done
  [ $PREVIEW_MISSING -eq 0 ] && echo "âœ… device-preview: å…¨éƒ¨è·¯å¾‘æ­£ç¢º" || { echo "âŒ device-preview ç¼ºå°‘ $PREVIEW_MISSING å€‹æª”æ¡ˆ"; ERRORS=$((ERRORS+PREVIEW_MISSING)); }
fi

# 5. é©—è­‰ loadScreen æ•¸é‡èˆ‡å¯¦éš›ç•«é¢æ•¸é‡ä¸€è‡´
PREVIEW_COUNT=$(grep -oE "loadScreen\('[^']+\.html'" device-preview.html | sort -u | wc -l | tr -d ' ')
[ "$PREVIEW_COUNT" -eq "$IPAD_COUNT" ] && echo "âœ… device-preview ç•«é¢æ•¸: $PREVIEW_COUNT" || { echo "âŒ device-preview ($PREVIEW_COUNT) â‰  å¯¦éš› ($IPAD_COUNT)"; ERRORS=$((ERRORS+1)); }

# çµæœ
echo ""
echo "======================================"
if [ $ERRORS -eq 0 ]; then
  echo "âœ… iframe src Path Validation PASSED"
else
  echo "âŒ iframe src Path Validation FAILED ($ERRORS errors)"
  echo "âš ï¸ ç¦æ­¢é€²å…¥ä¸‹ä¸€éšæ®µï¼"
  echo "ğŸ“‹ ä¿®å¾©æ–¹å¼:"
  echo "   1. ç¢ºèªæ‰€æœ‰ç•«é¢å·²æ­£ç¢ºç”Ÿæˆ"
  echo "   2. æ›´æ–° Diagram æª”æ¡ˆä½¿ç”¨æ­£ç¢ºçš„ç•«é¢è·¯å¾‘"
  echo "   3. æ›´æ–° device-preview.html å´é‚Šæ¬„"
  exit 1
fi
```

### é©—è­‰æ™‚æ©Ÿ

| ç¯€é»å®Œæˆå¾Œ | å¿…é ˆåŸ·è¡Œæ­¤é©—è­‰ |
|------------|----------------|
| 03-generation | âœ… ç”¢ç”Ÿç•«é¢å¾Œå¿…é ˆé©—è­‰ |
| 05-diagram | âœ… ç”¢ç”Ÿ Diagram å¾Œå¿…é ˆé©—è­‰ |
| 06-screenshot ä¹‹å‰ | âœ… æˆªåœ–å‰å¿…é ˆé©—è­‰è·¯å¾‘æ­£ç¢º |

> âš ï¸ **Critical**: è‹¥é©—è­‰å¤±æ•—ï¼Œ**ç¦æ­¢**é€²å…¥ä¸‹ä¸€ç¯€é»ï¼å¿…é ˆä¿®å¾©æ‰€æœ‰è·¯å¾‘å•é¡Œã€‚

### è‡ªå‹•é©—è­‰è¡Œç‚ºè¦æ±‚

1. **Claude å¿…é ˆä¸»å‹•åŸ·è¡Œ**ï¼šä¸éœ€ç”¨æˆ¶æé†’æˆ–è©¢å•
2. **é©—è­‰å¤±æ•—æ™‚ä¸èƒ½ç¹¼çºŒ**ï¼šå¿…é ˆä¿®å¾©å¾Œé‡æ–°é©—è­‰
3. **è¨˜éŒ„é©—è­‰çµæœ**ï¼šåœ¨ `current-process.json` ä¸­è¨˜éŒ„
4. **æ¯æ¬¡ compaction å¾Œæ¢å¾©**ï¼šé‡æ–°åŸ·è¡Œé©—è­‰ç¢ºèªç‹€æ…‹

### 07-feedback UI åŸå‹åƒè€ƒå®Œæ•´æ€§é©—è­‰ (Critical)

> **åœ¨æ¨™è¨˜ 07-feedback ç‚º completed å‰ï¼Œå¿…é ˆé€šéä»¥ä¸‹é©—è­‰ï¼**

```bash
#!/bin/bash
# === UI åŸå‹åƒè€ƒå®Œæ•´æ€§é©—è­‰ ===
cd {PROJECT}/02-design
SDD_FILE=$(ls SDD-*.md | head -1)

ERRORS=0
echo "ğŸ” åŸ·è¡Œ UI åŸå‹åƒè€ƒå®Œæ•´æ€§é©—è­‰..."

# 1. çµ±è¨ˆ SDD æœ¬æ–‡ç•«é¢æ•¸
SCREEN_COUNT=$(grep -c "^#### SCR-" "$SDD_FILE")

# 2. çµ±è¨ˆæœ‰åœ–ç‰‡åƒè€ƒçš„ç•«é¢æ•¸ (iPad)
IPAD_REF=$(grep -c "images/ipad/SCR-.*\.png" "$SDD_FILE")

# 3. çµ±è¨ˆæœ‰åœ–ç‰‡åƒè€ƒçš„ç•«é¢æ•¸ (iPhone)
IPHONE_REF=$(grep -c "images/iphone/SCR-.*\.png" "$SDD_FILE")

echo "ğŸ“Š çµ±è¨ˆçµæœ:"
echo "   SDD ç•«é¢æ•¸: $SCREEN_COUNT"
echo "   iPad åœ–ç‰‡åƒè€ƒ: $IPAD_REF"
echo "   iPhone åœ–ç‰‡åƒè€ƒ: $IPHONE_REF"

# 4. é©—è­‰ä¸€è‡´æ€§
[ "$SCREEN_COUNT" != "$IPAD_REF" ] && { echo "âŒ iPad åœ–ç‰‡åƒè€ƒä¸è¶³"; ERRORS=$((ERRORS+1)); }
[ "$SCREEN_COUNT" != "$IPHONE_REF" ] && { echo "âŒ iPhone åœ–ç‰‡åƒè€ƒä¸è¶³"; ERRORS=$((ERRORS+1)); }

# 5. é©—è­‰åœ–ç‰‡æª”æ¡ˆå­˜åœ¨
MISSING_IPAD=$(for f in $(grep -oE "images/ipad/SCR-[^)\"]+\.png" "$SDD_FILE" | sort -u); do [ ! -f "$f" ] && echo "$f"; done | wc -l)
MISSING_IPHONE=$(for f in $(grep -oE "images/iphone/SCR-[^)\"]+\.png" "$SDD_FILE" | sort -u); do [ ! -f "$f" ] && echo "$f"; done | wc -l)
[ "$MISSING_IPAD" -gt 0 ] && { echo "âŒ ç¼ºå°‘ $MISSING_IPAD å€‹ iPad åœ–ç‰‡æª”æ¡ˆ"; ERRORS=$((ERRORS+1)); }
[ "$MISSING_IPHONE" -gt 0 ] && { echo "âŒ ç¼ºå°‘ $MISSING_IPHONE å€‹ iPhone åœ–ç‰‡æª”æ¡ˆ"; ERRORS=$((ERRORS+1)); }

# çµæœ
echo ""
if [ $ERRORS -eq 0 ]; then
  echo "âœ… UI åŸå‹åƒè€ƒå®Œæ•´æ€§é©—è­‰ PASSED"
else
  echo "âŒ UI åŸå‹åƒè€ƒå®Œæ•´æ€§é©—è­‰ FAILED ($ERRORS errors)"
  exit 1
fi
```

| é©—è­‰é …ç›® | é æœŸçµæœ |
|----------|----------|
| SDD ç•«é¢æ•¸ = iPad åœ–ç‰‡åƒè€ƒæ•¸ | 100% ä¸€è‡´ |
| SDD ç•«é¢æ•¸ = iPhone åœ–ç‰‡åƒè€ƒæ•¸ | 100% ä¸€è‡´ |
| æ‰€æœ‰åƒè€ƒçš„åœ–ç‰‡æª”æ¡ˆéƒ½å­˜åœ¨ | 0 ç¼ºå¤± |

### SDD Use Case å®Œæ•´æ€§é©—è­‰ (Critical)

> **åœ¨å›è£œ SDD æ™‚ï¼Œå¿…é ˆåŒæ™‚é©—è­‰ Use Case å®Œæ•´æ€§ï¼**

```bash
#!/bin/bash
# === Use Case å®Œæ•´æ€§é©—è­‰ ===
cd {PROJECT}/02-design
SDD_FILE=$(ls SDD-*.md | head -1)

echo "ğŸ” åŸ·è¡Œ Use Case å®Œæ•´æ€§é©—è­‰..."

# 1. çµ±è¨ˆ Use Case ç¸½è¦½è¡¨ä¸­çš„ UC æ•¸é‡
TABLE_UC=$(grep -E "^\| UC-" "$SDD_FILE" | grep -v "^| UC-ID" | wc -l | tr -d ' ')

# 2. çµ±è¨ˆè©³ç´°æè¿°ç« ç¯€ä¸­çš„ UC æ•¸é‡
DETAIL_UC=$(grep -c "^#### UC-" "$SDD_FILE")

echo "ğŸ“Š çµ±è¨ˆçµæœ:"
echo "   ç¸½è¦½è¡¨ UC æ•¸: $TABLE_UC"
echo "   è©³ç´°æè¿° UC æ•¸: $DETAIL_UC"

# 3. é©—è­‰ä¸€è‡´æ€§
if [ "$TABLE_UC" != "$DETAIL_UC" ]; then
  echo ""
  echo "âŒ Use Case æ•¸é‡ä¸ä¸€è‡´ï¼"
  echo ""
  echo "ğŸ“‹ ç¸½è¦½è¡¨ä¸­çš„ UC:"
  grep -E "^\| UC-" "$SDD_FILE" | grep -v "^| UC-ID" | awk -F'|' '{print "   " $2}'
  echo ""
  echo "ğŸ“‹ è©³ç´°æè¿°ä¸­çš„ UC:"
  grep "^#### UC-" "$SDD_FILE" | sed 's/^#### /   /'
  echo ""
  echo "âš ï¸ è«‹è£œå……ç¼ºå°‘çš„ Use Case è©³ç´°æè¿°ï¼"
  exit 1
else
  echo "âœ… Use Case å®Œæ•´æ€§é©—è­‰ PASSED ($TABLE_UC å€‹)"
fi
```

| é©—è­‰é …ç›® | é æœŸçµæœ |
|----------|----------|
| ç¸½è¦½è¡¨ UC æ•¸ = è©³ç´°æè¿° UC æ•¸ | 100% ä¸€è‡´ |
| æ¯å€‹ UC éƒ½æœ‰å‰ç½®/å¾Œç½®æ¢ä»¶ | å¿…å‚™ |
| æ¯å€‹ UC éƒ½æœ‰ä¸»è¦æµç¨‹ | å¿…å‚™ |

### ASCII Art ç¦æ­¢é©—è­‰ (Critical)

> **å›è£œæ–‡ä»¶å‰ï¼Œå¿…é ˆç¢ºèªç„¡ ASCII Artï¼**

```bash
#!/bin/bash
# ASCII Art åµæ¸¬é©—è­‰
cd {PROJECT}
echo "ğŸ” é©—è­‰æ˜¯å¦æœ‰ç¦ç”¨çš„ ASCII Art..."

ERRORS=0
for FILE in 01-requirements/SRS-*.md 02-design/SDD-*.md; do
  if [ -f "$FILE" ]; then
    ASCII_BLOCKS=$(awk '/^```[^m]|^```$/{flag=1; next} /^```/{flag=0} flag && /[â”Œâ”â””â”˜â”‚â”€â”œâ”¤â”¬â”´â”¼â†’â†â†‘â†“â–¶â—€â– â–¡â—â—‹]/' "$FILE" | wc -l | tr -d ' ')
    if [ "$ASCII_BLOCKS" -gt 0 ]; then
      echo "âŒ $FILE å«æœ‰ ASCII Art ($ASCII_BLOCKS è¡Œ)"
      ERRORS=$((ERRORS+1))
    fi
  fi
done

[ $ERRORS -eq 0 ] && echo "âœ… ç„¡ ASCII Art é•è¦" || { echo "âš ï¸ è«‹æ”¹ç”¨ Mermaid"; exit 1; }
```

---

## Process Chain (å®Œæ•´ç‰ˆ)

| Step | Process | é€²å…¥æ¢ä»¶ | é€€å‡ºæ¢ä»¶ |
|------|---------|----------|----------|
| 00 | init | SDD å®Œæ•´ + æ™ºæ…§é æ¸¬å®Œæˆ | æ¨¡æ¿å·²è¤‡è£½ã€è®Šæ•¸å·²æ›¿æ› |
| 03 | generation | 00 å®Œæˆ | **100% ç•«é¢** HTML å·²ç”¢ç”Ÿ |
| 04 | validation | 03 å®Œæˆ | **100% Navigation + 0 alert** (BLOCKING) |
| 05 | diagram | 04 å®Œæˆ | UI Flow Diagram (iPad/iPhone é›™ç‰ˆæœ¬) |
| 06 | screenshot | 05 å®Œæˆ + è·¯å¾‘é©—è­‰é€šé | iPad/iPhone æˆªåœ–å·²ç”¢ç”Ÿ (è¦‹ Error Recovery) |
| **07** | **feedback** | 06 å®Œæˆ | **SDD/SRS å·²å›è£œ + DOCX å·²é‡æ–°ç”¢ç”Ÿ** âš ï¸ |
| 08 | finalize | 07 å®Œæˆ | è¿½æº¯é©—è­‰é€šé + å®Œæˆå ±å‘Š |

> âš ï¸ **æ³¨æ„**: 01-discovery å’Œ 02-planning å·²ç”± app-requirements-skill å®Œæˆï¼Œæœ¬ Skill è·³é

### ğŸš¨ 06-screenshot Error Recovery Logic (BLOCKING)

> **è‹¥æˆªåœ–éç¨‹ä¸­ç™¼ç¾ç•«é¢ä¸å­˜åœ¨ï¼Œå¿…é ˆè¿”å› 03-generation é‡æ–°ç”Ÿæˆï¼**

#### æˆªåœ–å‰å¿…é ˆé©—è­‰

```bash
#!/bin/bash
# === 06-screenshot Pre-Validation (BLOCKING) ===
cd {PROJECT}/04-ui-flow

echo "ğŸ” æˆªåœ–å‰é©—è­‰..."

# 1. åŸ·è¡Œ iframe src Path Validation (è¦‹ä¸Šæ–¹)
# 2. è‹¥å¤±æ•—ï¼Œç¦æ­¢é€²å…¥ 06-screenshot

# 3. é¡å¤–é©—è­‰ï¼šç¢ºèª Diagram ç•«é¢æ•¸èˆ‡å¯¦éš›ä¸€è‡´
ACTUAL_COUNT=$(find . -name "SCR-*.html" -not -path "./iphone/*" -not -path "./docs/*" | wc -l | tr -d ' ')
DIAGRAM_IPAD_COUNT=$(grep -c 'onclick="openScreen' docs/ui-flow-diagram-ipad.html 2>/dev/null || echo "0")
DIAGRAM_IPHONE_COUNT=$(grep -c 'onclick="openScreen' docs/ui-flow-diagram-iphone.html 2>/dev/null || echo "0")

if [ "$ACTUAL_COUNT" != "$DIAGRAM_IPAD_COUNT" ] || [ "$ACTUAL_COUNT" != "$DIAGRAM_IPHONE_COUNT" ]; then
  echo "âŒ ç•«é¢æ•¸ä¸ä¸€è‡´ï¼"
  echo "   å¯¦éš›ç•«é¢: $ACTUAL_COUNT"
  echo "   iPad Diagram: $DIAGRAM_IPAD_COUNT"
  echo "   iPhone Diagram: $DIAGRAM_IPHONE_COUNT"
  echo ""
  echo "âš ï¸ å¿…é ˆè¿”å› 05-diagram é‡æ–°ç”Ÿæˆ Diagramï¼"
  exit 1
fi

echo "âœ… æˆªåœ–å‰é©—è­‰é€šéï¼Œå¯ä»¥åŸ·è¡Œæˆªåœ–"
```

#### æˆªåœ–éŒ¯èª¤è™•ç†æµç¨‹

```
06-screenshot åŸ·è¡Œæ™‚ï¼š

1. Puppeteer å˜—è©¦è¼‰å…¥ç•«é¢
   â”œâ”€â”€ æˆåŠŸ â†’ ç¹¼çºŒæˆªåœ–
   â””â”€â”€ å¤±æ•— (404/ç„¡æ³•è¼‰å…¥) â†’ Error Recovery æµç¨‹

2. Error Recovery æµç¨‹ï¼š
   â”œâ”€â”€ è¨˜éŒ„ç¼ºå°‘çš„ç•«é¢ ID åˆ° error-log.json
   â”œâ”€â”€ çµ±è¨ˆéŒ¯èª¤æ•¸é‡
   â””â”€â”€ è‹¥æœ‰ä»»ä½•éŒ¯èª¤ â†’ è¿”å› 03-generation

3. è¿”å› 03-generationï¼š
   â”œâ”€â”€ é‡è¨­ current-process.json: current_process = "03-generation"
   â”œâ”€â”€ é‡è¨­ progress: 03-generation = "in_progress"
   â”œâ”€â”€ è®€å– error-log.json æ‰¾å‡ºç¼ºå°‘çš„ç•«é¢
   â”œâ”€â”€ è£œå……ç”Ÿæˆç¼ºå°‘çš„ç•«é¢
   â””â”€â”€ å®Œæˆå¾Œé‡æ–°èµ° 04 â†’ 05 â†’ 06 æµç¨‹
```

#### capture-screenshots.js Error Recovery å¯¦ä½œ

```javascript
// åœ¨ capture-screenshots.js ä¸­åŠ å…¥
async function captureScreen(page, screenPath, outputPath) {
  try {
    const response = await page.goto(`file://${screenPath}`, {
      waitUntil: 'networkidle0',
      timeout: 10000
    });

    if (!response || response.status() === 404) {
      throw new Error(`Screen not found: ${screenPath}`);
    }

    await page.screenshot({ path: outputPath });
    return { success: true, path: screenPath };
  } catch (error) {
    console.error(`âŒ æˆªåœ–å¤±æ•—: ${screenPath}`);
    return {
      success: false,
      path: screenPath,
      error: error.message,
      recovery: 'return-to-03-generation'
    };
  }
}

// åŸ·è¡Œå®Œç•¢å¾Œæª¢æŸ¥
async function processResults(results) {
  const failures = results.filter(r => !r.success);

  if (failures.length > 0) {
    console.log('');
    console.log('ğŸš¨ æˆªåœ–å¤±æ•—çµ±è¨ˆ:');
    console.log(`   å¤±æ•—æ•¸é‡: ${failures.length}`);
    console.log(`   ç¼ºå°‘ç•«é¢: ${failures.map(f => f.path).join(', ')}`);
    console.log('');
    console.log('âš ï¸ å¿…é ˆè¿”å› 03-generation è£œå……ç¼ºå°‘çš„ç•«é¢ï¼');

    // å¯«å…¥ error-log.json
    const errorLog = {
      timestamp: new Date().toISOString(),
      phase: '06-screenshot',
      failures: failures,
      recovery_action: 'return-to-03-generation',
      missing_screens: failures.map(f => f.path.match(/SCR-[^/]+/)?.[0]).filter(Boolean)
    };

    fs.writeFileSync(
      path.join(process.cwd(), 'workspace/screenshot-error-log.json'),
      JSON.stringify(errorLog, null, 2)
    );

    // æ›´æ–° current-process.json
    const processFile = path.join(process.cwd(), 'workspace/current-process.json');
    const processData = JSON.parse(fs.readFileSync(processFile, 'utf8'));
    processData.current_process = '03-generation';
    processData.progress['03-generation'] = 'in_progress';
    processData.progress['04-validation'] = 'pending';
    processData.progress['05-diagram'] = 'pending';
    processData.progress['06-screenshot'] = 'pending';
    processData.context.last_action = `Screenshot failed: ${failures.length} screens missing`;
    fs.writeFileSync(processFile, JSON.stringify(processData, null, 2));

    process.exit(1);
  }

  console.log('âœ… æ‰€æœ‰æˆªåœ–å®Œæˆ');
}
```

#### å¤±æ•—åŸå› èˆ‡ä¿®å¾©

| å¤±æ•—åŸå›  | ä¿®å¾©æ–¹å¼ |
|----------|----------|
| ç•«é¢æª”æ¡ˆä¸å­˜åœ¨ | è¿”å› 03-generation ç”Ÿæˆç¼ºå°‘çš„ç•«é¢ |
| è·¯å¾‘éŒ¯èª¤ (typo) | ä¿®æ­£ Diagram/device-preview ä¸­çš„è·¯å¾‘ |
| ç•«é¢ ID ä¸ä¸€è‡´ | ç¢ºèª SDD èˆ‡å¯¦éš›ç”Ÿæˆçš„ç•«é¢ ID ä¸€è‡´ |
| æ¨¡çµ„è³‡æ–™å¤¾éŒ¯èª¤ | ç¢ºèªæ¨¡çµ„åç¨±å°æ‡‰ (auth â†’ AUTH) |

### 07-feedback å›è£œæ­¥é©Ÿè©³è§£

```
1. æ›´æ–° SDD æ¯å€‹ SCR-* å€å¡Š:
   â”œâ”€â”€ åŠ å…¥ UI åŸå‹åƒè€ƒ (ä¸ä½¿ç”¨è¡¨æ ¼)
   â”œâ”€â”€ iPad ç‰ˆæœ¬ï¼š![](images/ipad/SCR-*.png)
   â””â”€â”€ iPhone ç‰ˆæœ¬ï¼š![](images/iphone/SCR-*.png)

2. æ›´æ–° SRS:
   â”œâ”€â”€ æ–°å¢ Screen References ç« ç¯€ (REQ â†’ SCR å°ç…§)
   â”œâ”€â”€ æ–°å¢ Inferred Requirements (å¾ UI Flow æ¨å°)
   â””â”€â”€ æ›´æ–° User Flows (Mermaid æµç¨‹åœ–)

3. é‡æ–°ç”¢ç”Ÿ DOCX:
   â”œâ”€â”€ node md-to-docx.js SDD-*.md â†’ SDD.docx (å«æˆªåœ–)
   â””â”€â”€ node md-to-docx.js SRS-*.md â†’ SRS.docx
```

---

## Node Loading Protocol

```
Claude æ”¶åˆ° skill å•Ÿç”¨æ™‚ï¼š
1. è®€å–æ­¤ SKILL.md (æœ¬æª”æ¡ˆ)
2. å¾ skill args å–å¾—å°ˆæ¡ˆè·¯å¾‘ (PROJECT_PATH)
3. é©—è­‰é€²å…¥æ¢ä»¶:
   - æª¢æŸ¥ SDD æ˜¯å¦å­˜åœ¨
   - æª¢æŸ¥ screen-prediction.json æ˜¯å¦å­˜åœ¨ä¸” completion_status = "completed"
   - è‹¥æœªå®Œæˆ â†’ æ‹’çµ•é€²å…¥ï¼Œæç¤ºå…ˆå®Œæˆ Phase 2
4. è®€å– {PROJECT_PATH}/04-ui-flow/workspace/current-process.json
   - è‹¥æª”æ¡ˆä¸å­˜åœ¨ â†’ å¾ 00-init é–‹å§‹
   - è‹¥ current_process å­˜åœ¨ â†’ æ¢å¾©åˆ°è©²ç¯€é»
5. è®€å– [SKILL_DIR]/process/{current}/README.md
6. åŸ·è¡Œç¯€é»æ­¥é©Ÿ
7. å®Œæˆå¾Œæ›´æ–°å°ˆæ¡ˆçš„ workspace/current-process.json
8. é€²å…¥ä¸‹ä¸€ç¯€é»
```

**è·¯å¾‘èªªæ˜ï¼š**
- `[SKILL_DIR]` = `~/.claude/skills/app-uiux-designer.skill/` (skill æœ¬èº«)
- `{PROJECT_PATH}` = å°ˆæ¡ˆæ ¹ç›®éŒ„ (å¾ args å–å¾—)
- workspace åœ¨å°ˆæ¡ˆ: `{PROJECT_PATH}/04-ui-flow/workspace/`

---

## é€²å…¥æ¢ä»¶é©—è­‰ (Critical)

åœ¨é–‹å§‹ UI Flow ç”Ÿæˆå‰ï¼Œå¿…é ˆé©—è­‰ï¼š

```json
// æª¢æŸ¥ {PROJECT}/04-ui-flow/workspace/screen-prediction.json
{
  "completion_status": "completed",  // å¿…é ˆç‚º completed
  "sdd_updated": true,               // å¿…é ˆç‚º true
  "analysis": {
    "total_screens": 53              // å¿…é ˆ > 0
  }
}
```

è‹¥é©—è­‰å¤±æ•—ï¼Œé¡¯ç¤ºè¨Šæ¯ï¼š
```
âš ï¸ ç„¡æ³•é€²å…¥ UI Flow éšæ®µ
åŸå› : æ™ºæ…§é æ¸¬å°šæœªå®Œæˆ
è«‹å…ˆå®Œæˆ Phase 2 (app-requirements-skill):
- åŸ·è¡Œæ™ºæ…§é æ¸¬
- è£œå……æ‰€æœ‰é æ¸¬ç•«é¢
- ç¢ºèª Appendix A ç•«é¢æ¸…å–®
```

---

## Workspace Management

| æª”æ¡ˆ (å°ˆæ¡ˆå…§) | èªªæ˜ |
|---------------|------|
| `04-ui-flow/workspace/current-process.json` | ç›®å‰æµç¨‹ç‹€æ…‹ |
| `04-ui-flow/workspace/screen-prediction.json` | æ™ºæ…§é æ¸¬çµæœ (Phase 2 ç”¢ç”Ÿ) |
| `04-ui-flow/workspace/state/` | Compaction ä¿å­˜é» |

### åˆå§‹åŒ– workspace

```bash
# åœ¨å°ˆæ¡ˆçš„ 04-ui-flow/ ä¸‹å»ºç«‹ workspace
mkdir -p {PROJECT}/04-ui-flow/workspace/{context,state}
```

---

## Blocking Checkpoints

| ç¯€é» | é˜»æ–·æ¢ä»¶ |
|------|----------|
| é€²å…¥æ¢ä»¶ | **æ™ºæ…§é æ¸¬å¿…é ˆå®Œæˆ** (screen-prediction.json) |
| 00-init | æ¨¡æ¿å¿…é ˆå®Œæ•´è¤‡è£½ã€è®Šæ•¸å¿…é ˆæ›¿æ› |
| 03-generation | **100% ç•«é¢å·²ç”Ÿæˆ**ï¼Œç„¡éºæ¼ |
| 04-validation | **100% Navigation + 0 ç©ºæŒ‰éˆ• + 0 alert** |
| **05-diagram** | **iframe src Path Validation å¿…é ˆé€šé** (è¦‹é©—è­‰ç« ç¯€) |
| **06-screenshot** | **Pre-Validation å¿…é ˆé€šé + è‹¥æˆªåœ–å¤±æ•— â†’ è¿”å› 03-generation** |

---

## Device Specifications

| Device | Viewport | Body Style |
|--------|----------|------------|
| iPad Pro 11" | 1194 x 834 | `width: 1194px; height: 834px;` |
| iPhone 15/16 Pro | 393 x 852 | `width: 393px; height: 852px;` |

---

## Key Scripts

| è…³æœ¬ | ä½ç½® | èªªæ˜ |
|------|------|------|
| init-project.sh | `process/00-init/templates/` | å°ˆæ¡ˆåˆå§‹åŒ– |
| **post-generation-gate.js** | `templates/ui-flow/` | **ğŸš¨ ç”¢ç”Ÿå¾Œé–˜é–€ (BLOCKING - è‡ªå‹•åŸ·è¡Œæ‰€æœ‰é©—è­‰)** |
| validate-navigation.js | `templates/ui-flow/` | å°èˆªé©—è­‰ |
| validate-iframe-src.js | `templates/ui-flow/` | iframe src è·¯å¾‘é©—è­‰ |
| validate-consistency.js | `templates/ui-flow/` | ä¸€è‡´æ€§é©—è­‰ |
| capture-screenshots.js | `templates/ui-flow/` | æˆªåœ–ç”Ÿæˆ |
| convert-to-iphone.sh | å°ˆæ¡ˆå…§ `scripts/` | iPadâ†’iPhone è½‰æ› |

### ğŸš¨ post-generation-gate.js (MANDATORY)

> **ç”¢ç”Ÿ index.html / device-preview.html / Diagram å¾Œå¿…é ˆåŸ·è¡Œï¼**

```bash
# ç”¢ç”Ÿæª”æ¡ˆå¾Œç«‹å³åŸ·è¡Œ
node ~/.claude/skills/app-uiux-designer.skill/templates/ui-flow/post-generation-gate.js

# æˆ–æŒ‡å®šå°ˆæ¡ˆè·¯å¾‘
node ~/.claude/skills/app-uiux-designer.skill/templates/ui-flow/post-generation-gate.js /path/to/04-ui-flow
```

**è‡ªå‹•åŸ·è¡Œçš„é©—è­‰:**
1. âœ… å¿…è¦æª”æ¡ˆå­˜åœ¨æª¢æŸ¥ (index.html, device-preview.html, Diagrams)
2. âœ… `validate-iframe-src.js` - iPad/iPad mini/iPhone è·¯å¾‘é©—è­‰
3. âœ… `validate-consistency.js` - ä¸€è‡´æ€§é©—è­‰
4. âœ… `validate-navigation.js` - å°èˆªé©—è­‰

**é©—è­‰çµæœ:**
- `PASSED` â†’ å¯ä»¥é€²å…¥ä¸‹ä¸€éšæ®µ
- `FAILED` â†’ **ç¦æ­¢é€²å…¥ä¸‹ä¸€éšæ®µ**ï¼Œè‡ªå‹•é‡è¨­ progress

**è‡ªå‹•è¡Œç‚º:**
- æ›´æ–° `workspace/current-process.json` çš„ validation_passed ç‹€æ…‹
- è‹¥å¤±æ•—ï¼Œè‡ªå‹•å°‡ 03-generation / 05-diagram é‡è¨­ç‚º in_progress
- ç”¢ç”Ÿ `workspace/validation-report.json` è©³ç´°å ±å‘Š

---

### validate-iframe-src.js ä½¿ç”¨æ–¹å¼

```bash
# é©—è­‰ç•¶å‰ç›®éŒ„
node ~/.claude/skills/app-uiux-designer.skill/templates/ui-flow/validate-iframe-src.js

# é©—è­‰æŒ‡å®šå°ˆæ¡ˆ
node ~/.claude/skills/app-uiux-designer.skill/templates/ui-flow/validate-iframe-src.js /path/to/project/04-ui-flow
```

**é©—è­‰å…§å®¹:**
- `docs/ui-flow-diagram-ipad.html` çš„æ‰€æœ‰ iframe src
- `docs/ui-flow-diagram-iphone.html` çš„æ‰€æœ‰ iframe src
- `device-preview.html` çš„ loadScreen() / iframe src / data-iphone è·¯å¾‘
- ç•«é¢æ•¸é‡ä¸€è‡´æ€§ (å¯¦éš›æª”æ¡ˆ = Diagram = device-preview)

**Exit Code:**
- `0` - é©—è­‰é€šé
- `1` - é©—è­‰å¤±æ•— (BLOCKING)

---

## References (æŒ‰éœ€è¼‰å…¥)

| é¡åˆ¥ | æª”æ¡ˆ |
|------|------|
| **æ–‡ä»¶æ¨™æº–** | `~/.claude/skills/app-requirements-skill/references/iec62304-document-standards.md` |
| **å¿…è¦æ¨¡çµ„ HTML** | `templates/common-modules/{auth,profile,setting,common}/` |
| å¹³å° | `references/platforms/{ios-hig,material-design,wcag}.md` |
| å¿ƒç†å­¸ | `references/psychology/{gestalt,cognitive,emotional}.md` |
| ç¨‹å¼ç¢¼ç”Ÿæˆ | `references/code-gen/{react,angular,swiftui,compose}.md` |

### å¿…è¦æ¨¡çµ„ HTML æ¨¡æ¿

åœ¨ **00-init** éšæ®µï¼Œå¯å¾ `templates/common-modules/` è¤‡è£½å¿…è¦æ¨¡çµ„æ¨¡æ¿ï¼š

| æ¨¡çµ„ | æ¨¡æ¿æ•¸é‡ | èªªæ˜ |
|------|----------|------|
| auth | 3 å€‹ | login, register, forgot |
| profile | 2 å€‹ | view, edit |
| setting | 4 å€‹ | main, account, privacy, about |
| common | 4 å€‹ | loading, empty, error, no-network |

> ğŸ“ æ¨¡æ¿åŒ…å« `{{VARIABLE}}` ä½”ä½ç¬¦ï¼Œéœ€æ ¹æ“šå°ˆæ¡ˆè¨­å®šæ›¿æ›

> âš ï¸ **07-feedback å›è£œæ™‚å¿…é ˆéµå¾ª `iec62304-document-standards.md`**
> - Mermaid åœ–è¡¨ä½¿ç”¨ `flowchart TB` (ç›´å¼)
> - ç¦æ­¢ ASCII Art
> - SCR å€å¡Šæ ¼å¼éœ€åŒ…å« UI åŸå‹è¡¨æ ¼
> - DOCX è½‰æ›ä½¿ç”¨ `md-to-docx.js`

---

## Commands

| æŒ‡ä»¤ | å‹•ä½œ |
|------|------|
| `é€²å…¥ç¯€é» XX` | è®€å– `process/XX/README.md` |
| `ä¸‹ä¸€æ­¥` | è‡ªå‹•åˆ¤æ–·ä¸¦é€²å…¥ä¸‹ä¸€ç¯€é» |
| `ä¿å­˜ç‹€æ…‹` | è¤‡è£½ current-process.json åˆ° state/ |
| `æ¢å¾©ç‹€æ…‹` | å¾ state/ è®€å–ä¸¦æ¢å¾© |
| `é¡¯ç¤ºé€²åº¦` | è®€å– current-process.json çš„ progress |

---

## Screen ID Format

| é¡å‹ | æ ¼å¼ | ç¯„ä¾‹ |
|------|------|------|
| ç•«é¢ | `SCR-{MODULE}-{NNN}-{name}` | SCR-AUTH-001-login |
| éœ€æ±‚ | `REQ-{MODULE}-{NNN}` | REQ-AUTH-001 |

**Module Codes:** AUTH, ONBOARD, HOME, VOCAB, TRAIN, REPORT, SETTING, PARENT, PROFILE, COMMON

---

## è¼¸å‡ºçµæœ

å®Œæˆ Phase 3 å¾Œï¼Œç”¢ç”Ÿä»¥ä¸‹æª”æ¡ˆä¾› Phase 4 ä½¿ç”¨ï¼š

```
ğŸ“ 04-ui-flow/
â”œâ”€â”€ ğŸ“ ipad/
â”‚   â”œâ”€â”€ SCR-AUTH-001-login.html
â”‚   â”œâ”€â”€ SCR-AUTH-002-register.html
â”‚   â””â”€â”€ ... (æ‰€æœ‰ç•«é¢)
â”œâ”€â”€ ğŸ“ iphone/
â”‚   â””â”€â”€ ... (iPhone ç‰ˆæœ¬)
â”œâ”€â”€ ğŸ“ screenshots/
â”‚   â”œâ”€â”€ ğŸ“ ipad/
â”‚   â”‚   â””â”€â”€ *.png
â”‚   â””â”€â”€ ğŸ“ iphone/
â”‚       â””â”€â”€ *.png
â””â”€â”€ ğŸ“ workspace/
    â””â”€â”€ current-process.json (progress.06-screenshot = "completed")
```

---

## Architecture Benefits

1. **æ¸›å°‘ Token ä½¿ç”¨** - åªè¼‰å…¥ç•¶å‰ç¯€é»ç›¸é—œæª”æ¡ˆ
2. **Compaction æ¢å¾©** - ç‹€æ…‹ä¿å­˜åœ¨ workspace/
3. **æ¸…æ™°æµç¨‹** - æ¯å€‹ç¯€é»æœ‰æ˜ç¢ºé€²å…¥/é€€å‡ºæ¢ä»¶
4. **æ•´åˆç°¡åŒ–** - æ™ºæ…§é æ¸¬åœ¨ Phase 2 å®Œæˆï¼Œæœ¬ Skill å°ˆæ³¨ UI Flow

---

## ğŸš¨ Anti-Forgetting Protocol (CRITICAL)

> **é˜²æ­¢ Claude åœ¨ Compaction æˆ–é•·å°è©±ä¸­éºå¿˜é©—è­‰æ­¥é©Ÿçš„æ©Ÿåˆ¶**

### å•é¡ŒèƒŒæ™¯

Claude AI æœ‰ä»¥ä¸‹é™åˆ¶å¯èƒ½å°è‡´éºå¿˜ï¼š
1. **Context Window é™åˆ¶** - å°è©±éé•·æœƒè§¸ç™¼ compactionï¼ˆå£“ç¸®ï¼‰
2. **Compaction è³‡è¨Šæå¤±** - å£“ç¸®æ™‚ "how" æ¯” "what" æ›´å®¹æ˜“éºå¤±
3. **æ³¨æ„åŠ›åˆ†æ•£** - é•·å°è©±ä¸­å¾Œé¢çš„æŒ‡ä»¤å„ªå…ˆç´šå¯èƒ½é™ä½
4. **ç‹€æ…‹ä¸ä¸€è‡´** - è¨˜æ†¶ä¸­çš„ç‹€æ…‹èˆ‡å¯¦éš›æª”æ¡ˆç‹€æ…‹å¯èƒ½ä¸åŒ

### æ ¸å¿ƒåŸå‰‡

```
æ¯å€‹ç¯€é»å®Œæˆå‰ï¼š
1. å¿…é ˆåŸ·è¡Œ exit-validation.sh
2. å¿…é ˆæ›´æ–° current-process.json çš„ validation_state
3. å¿…é ˆè¨˜éŒ„åˆ° validation-chain.json

Compaction å¾Œæ¢å¾©ï¼š
1. åŸ·è¡Œ quick-health-check.sh
2. è®€å– validation-chain.json ç¢ºèªå·²å®Œæˆçš„é©—è­‰
3. å¾æœ€å¾Œä¸€å€‹æœ‰æ•ˆç‹€æ…‹ç¹¼çºŒ
```

### Enhanced current-process.json çµæ§‹

```json
{
  "project_name": "WordPlay",
  "current_process": "04-validation",
  "last_updated": "2026-01-16T10:30:00Z",
  "progress": {
    "00-init": "completed",
    "03-generation": "completed",
    "04-validation": "in_progress",
    "05-diagram": "pending",
    "06-screenshot": "pending",
    "07-feedback": "pending",
    "08-finalize": "pending"
  },
  "validation_state": {
    "00-init": {
      "passed": true,
      "timestamp": "2026-01-16T09:00:00Z",
      "checks": ["templates_copied", "variables_replaced"]
    },
    "03-generation": {
      "passed": true,
      "timestamp": "2026-01-16T09:30:00Z",
      "checks": ["all_screens_generated", "onclick_coverage", "index_populated"]
    },
    "04-validation": {
      "passed": false,
      "timestamp": null,
      "pending_checks": ["navigation_100%", "zero_alerts", "consistency"]
    }
  },
  "recovery_hints": {
    "last_action": "Fixed onclick handlers in parent module",
    "pending_fixes": [],
    "files_modified": ["parent/SCR-PARENT-002.html", "parent/SCR-PARENT-003.html"]
  },
  "context": {
    "total_screens": 48,
    "modules": ["auth", "common", "dash", "parent", "profile", "progress", "setting", "train", "vocab"]
  }
}
```

### validation-chain.json çµæ§‹

```json
{
  "chain": [
    {
      "node": "00-init",
      "validation": "exit-validation",
      "result": "PASSED",
      "timestamp": "2026-01-16T09:00:00Z",
      "details": {
        "templates_copied": true,
        "variables_replaced": true
      }
    },
    {
      "node": "03-generation",
      "validation": "template-compliance-gate",
      "result": "PASSED",
      "timestamp": "2026-01-16T09:30:00Z",
      "details": {
        "ipad_screens": 48,
        "iphone_screens": 48,
        "onclick_coverage": "100%",
        "index_populated": true
      }
    }
  ],
  "last_valid_checkpoint": "03-generation"
}
```

### Exit Validation Scripts

æ¯å€‹ç¯€é»éƒ½éœ€è¦ä¸€å€‹ `exit-validation.sh`ï¼š

| ç¯€é» | é©—è­‰è…³æœ¬ | é©—è­‰å…§å®¹ |
|------|----------|----------|
| 00-init | `process/00-init/exit-validation.sh` | æ¨¡æ¿å®Œæ•´ã€è®Šæ•¸æ›¿æ› |
| 03-generation | `process/03-generation/exit-validation.sh` | ç•«é¢ 100%ã€onclickã€index.html |
| 04-validation | `process/04-validation/exit-validation.sh` | å°èˆª 100%ã€0 alert |
| 05-diagram | `process/05-diagram/exit-validation.sh` | Diagram å®Œæ•´ã€è·¯å¾‘æ­£ç¢º |
| 06-screenshot | `process/06-screenshot/exit-validation.sh` | æˆªåœ–å­˜åœ¨ |
| 07-feedback | `process/07-feedback/exit-validation.sh` | SDD/SRS å›è£œå®Œæ•´ |

### Compaction Recovery Protocol

ç•¶ Claude å¾ compaction æ¢å¾©æ™‚ï¼Œ**å¿…é ˆç«‹å³åŸ·è¡Œ**ï¼š

```bash
# 1. åŸ·è¡Œå¿«é€Ÿå¥åº·æª¢æŸ¥
bash ~/.claude/skills/app-uiux-designer.skill/templates/ui-flow/quick-health-check.sh

# 2. æª¢æŸ¥è¼¸å‡ºä¸¦æ¢å¾©ç‹€æ…‹
node ~/.claude/skills/app-uiux-designer.skill/templates/ui-flow/recover-state.js
```

### quick-health-check.sh å…§å®¹

```bash
#!/bin/bash
# Quick Health Check - Compaction å¾Œç«‹å³åŸ·è¡Œ
cd "${1:-.}"

echo "ğŸ¥ Quick Health Check..."
echo ""

# 1. ç¢ºèª workspace å­˜åœ¨
[ -d "workspace" ] || { echo "âŒ workspace/ ä¸å­˜åœ¨"; exit 1; }

# 2. è®€å–ç•¶å‰ç‹€æ…‹
if [ -f "workspace/current-process.json" ]; then
  CURRENT=$(cat workspace/current-process.json | grep -o '"current_process": "[^"]*"' | cut -d'"' -f4)
  echo "ğŸ“ ç•¶å‰ç¯€é»: $CURRENT"
else
  echo "âš ï¸ current-process.json ä¸å­˜åœ¨"
  CURRENT="unknown"
fi

# 3. å¿«é€Ÿè¨ˆæ•¸
IPAD_COUNT=$(find . -name "SCR-*.html" -not -path "./iphone/*" -not -path "./docs/*" 2>/dev/null | wc -l | tr -d ' ')
IPHONE_COUNT=$(find ./iphone -name "SCR-*.html" 2>/dev/null | wc -l | tr -d ' ')
echo "ğŸ“Š ç•«é¢æ•¸: iPad=$IPAD_COUNT, iPhone=$IPHONE_COUNT"

# 4. æª¢æŸ¥é—œéµæª”æ¡ˆ
echo ""
echo "ğŸ“ é—œéµæª”æ¡ˆæª¢æŸ¥:"
[ -f "index.html" ] && echo "  âœ… index.html" || echo "  âŒ index.html"
[ -f "device-preview.html" ] && echo "  âœ… device-preview.html" || echo "  âŒ device-preview.html"
[ -f "docs/ui-flow-diagram-ipad.html" ] && echo "  âœ… ui-flow-diagram-ipad.html" || echo "  âŒ ui-flow-diagram-ipad.html"
[ -f "docs/ui-flow-diagram-iphone.html" ] && echo "  âœ… ui-flow-diagram-iphone.html" || echo "  âŒ ui-flow-diagram-iphone.html"

# 5. è®€å– validation chain
echo ""
if [ -f "workspace/validation-chain.json" ]; then
  echo "ğŸ“‹ å·²å®Œæˆçš„é©—è­‰:"
  cat workspace/validation-chain.json | grep -o '"node": "[^"]*"' | cut -d'"' -f4 | while read node; do
    echo "  âœ… $node"
  done
else
  echo "âš ï¸ validation-chain.json ä¸å­˜åœ¨ï¼Œéœ€è¦é‡æ–°é©—è­‰"
fi

echo ""
echo "ğŸ¥ Health Check å®Œæˆ"
echo "ğŸ“ è«‹å¾ç¯€é» '$CURRENT' ç¹¼çºŒ"
```

### å¼·åˆ¶åŸ·è¡Œè¦å‰‡

| æƒ…å¢ƒ | å¿…é ˆåŸ·è¡Œ |
|------|----------|
| ç¯€é»å®Œæˆæ™‚ | `exit-validation.sh` + æ›´æ–° `validation-chain.json` |
| Compaction å¾Œæ¢å¾© | `quick-health-check.sh` + `recover-state.js` |
| ç”¨æˆ¶è©¢å•é€²åº¦ | è®€å– `current-process.json` + `validation-chain.json` |
| é–‹å§‹æ–°ç¯€é» | ç¢ºèªå‰ä¸€ç¯€é»çš„ validation_state.passed = true |

### Claude è¡Œç‚ºè¦æ±‚

1. **æ¯æ¬¡å°è©±é–‹å§‹æ™‚**ï¼šæª¢æŸ¥æ˜¯å¦éœ€è¦åŸ·è¡Œ health check
2. **å®Œæˆä»»ä½•ä¿®æ”¹å¾Œ**ï¼šæ›´æ–° recovery_hints.last_action
3. **å®Œæˆç¯€é»å‰**ï¼šå¿…é ˆåŸ·è¡Œ exit-validation ä¸¦è¨˜éŒ„
4. **ç™¼ç¾ä¸ä¸€è‡´æ™‚**ï¼šå„ªå…ˆç›¸ä¿¡æª”æ¡ˆç‹€æ…‹è€Œéè¨˜æ†¶
